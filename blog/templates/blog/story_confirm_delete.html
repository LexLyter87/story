{% extends "blog/base.html" %}
{% load static %}

{% block title %}Удаление рассказа - {{ object.title }}{% endblock %}

{% block content %}
<div class="container">
  <!-- Хлебные крошки -->
  <nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a href="{% url 'blog:story_list' %}"><i class="bi bi-house-door"></i> Главная</a>
      </li>
      <li class="breadcrumb-item">
        <a href="{% url 'blog:dashboard' %}"><i class="bi bi-speedometer2"></i> Кабинет</a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">
        <i class="bi bi-trash"></i> Удаление рассказа
      </li>
    </ol>
  </nav>

  <div class="row justify-content-center">
    <div class="col-md-10 col-lg-8">
      <!-- Предупреждение -->
      <div class="alert alert-danger border-danger shadow-sm mb-4" role="alert">
        <div class="d-flex align-items-center">
          <i class="bi bi-exclamation-triangle-fill display-1 me-3"></i>
          <div>
            <h4 class="alert-heading mb-2">
              <i class="bi bi-shield-exclamation"></i> Внимание! Опасная операция
            </h4>
            <p class="mb-0">
              Вы собираетесь безвозвратно удалить рассказ. Это действие нельзя отменить.
              Будут удалены все комментарии и лайки.
            </p>
          </div>
        </div>
      </div>

      <!-- Информация о рассказе -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-white border-bottom">
          <h5 class="mb-0">
            <i class="bi bi-file-text"></i> Информация о рассказе
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <!-- Обложка (если есть) -->
            {% if object.cover_image %}
              <div class="col-md-4">
                <img src="{{ object.cover_image_thumbnail.url }}" 
                     class="img-fluid rounded shadow-sm" 
                     alt="{{ object.title }}"
                     style="width: 100%; height: auto;">
              </div>
            {% endif %}
            
            <div class="{% if object.cover_image %}col-md-8{% else %}col-12{% endif %}">
              <!-- Заголовок -->
              <h3 class="mb-3">{{ object.title }}</h3>
              
              <!-- Метаданные -->
              <div class="mb-3">
                <div class="row g-3">
                  <div class="col-sm-6">
                    <p class="mb-2">
                      <strong><i class="bi bi-person"></i> Автор:</strong><br>
                      <span class="text-muted">{{ object.author.username }}</span>
                    </p>
                  </div>
                  
                  <div class="col-sm-6">
                    <p class="mb-2">
                      <strong><i class="bi bi-calendar"></i> Создан:</strong><br>
                      <span class="text-muted">{{ object.created_at|date:"d.m.Y H:i" }}</span>
                    </p>
                  </div>
                  
                  {% if object.category %}
                    <div class="col-sm-6">
                      <p class="mb-2">
                        <strong><i class="bi bi-tag"></i> Категория:</strong><br>
                        <span class="badge bg-primary">{{ object.category.name }}</span>
                      </p>
                    </div>
                  {% endif %}
                  
                  <div class="col-sm-6">
                    <p class="mb-2">
                      <strong><i class="bi bi-eye"></i> Статус:</strong><br>
                      {% if object.status == 'PB' %}
                        <span class="badge bg-success">Опубликовано</span>
                      {% else %}
                        <span class="badge bg-warning text-dark">Черновик</span>
                      {% endif %}
                    </p>
                  </div>
                </div>
              </div>

              <!-- Превью текста -->
              {% if object.excerpt %}
                <div class="mb-3">
                  <strong><i class="bi bi-file-text"></i> Краткое описание:</strong>
                  <p class="text-muted mt-2">{{ object.excerpt|truncatewords:30 }}</p>
                </div>
              {% endif %}

              <!-- Статистика -->
              <div class="border-top pt-3">
                <strong class="d-block mb-2">
                  <i class="bi bi-bar-chart"></i> Статистика:
                </strong>
                <div class="d-flex gap-4">
                  <span class="text-muted">
                    <i class="bi bi-heart-fill text-danger"></i> 
                    {{ object.likes.count }} лайк{{ object.likes.count|pluralize:"ов" }}
                  </span>
                  <span class="text-muted">
                    <i class="bi bi-chat"></i> 
                    {{ object.comments.count }} комментари{{ object.comments.count|pluralize:"й,я,ев" }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Что будет удалено -->
      <div class="card shadow-sm mb-4 border-warning">
        <div class="card-header bg-warning bg-opacity-10 border-warning">
          <h6 class="mb-0">
            <i class="bi bi-info-circle"></i> Что будет удалено безвозвратно:
          </h6>
        </div>
        <div class="card-body">
          <ul class="mb-0">
            <li><i class="bi bi-check2"></i> Сам рассказ и весь его текст</li>
            <li><i class="bi bi-check2"></i> Все комментарии к рассказу ({{ object.comments.count }})</li>
            <li><i class="bi bi-check2"></i> Все лайки ({{ object.likes.count }})</li>
            {% if object.cover_image %}
              <li><i class="bi bi-check2"></i> Обложка рассказа</li>
            {% endif %}
          </ul>
        </div>
      </div>

      <!-- Форма подтверждения -->
      <div class="card shadow border-danger">
        <div class="card-header bg-danger text-white">
          <h5 class="mb-0">
            <i class="bi bi-trash"></i> Подтверждение удаления
          </h5>
        </div>
        <div class="card-body">
          <p class="fw-bold">
            Вы действительно хотите удалить рассказ "{{ object.title }}"?
          </p>
          <p class="text-danger">
            <i class="bi bi-exclamation-triangle-fill"></i> 
            <strong>Это действие необратимо!</strong> Восстановить данные будет невозможно.
          </p>
          
          <form method="post" class="mt-4" id="deleteForm">
            {% csrf_token %}
            
            <!-- Чекбокс подтверждения -->
            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" id="confirmDelete" required>
              <label class="form-check-label" for="confirmDelete">
                Я понимаю, что это действие нельзя отменить
              </label>
            </div>
            
            <div class="d-flex justify-content-between align-items-center gap-2">
              <a href="{% url 'blog:dashboard' %}" class="btn btn-secondary">
                <i class="bi bi-x-circle"></i> Отмена
              </a>
              <div class="d-flex gap-2">
                <a href="{{ object.get_absolute_url }}" class="btn btn-outline-primary">
                  <i class="bi bi-eye"></i> Просмотреть рассказ
                </a>
                <button type="submit" class="btn btn-danger" id="deleteButton" disabled>
                  <i class="bi bi-trash-fill"></i> Да, удалить навсегда
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- Альтернативные действия -->
      <div class="alert alert-info mt-4" role="alert">
        <h6 class="alert-heading">
          <i class="bi bi-lightbulb"></i> Рассматриваете альтернативы?
        </h6>
        <p class="mb-2">Вместо удаления вы можете:</p>
        <ul class="mb-0">
          <li>
            <a href="{% url 'blog:story_update' object.slug %}" class="alert-link">
              Отредактировать рассказ
            </a>
          </li>
          <li>Изменить статус на "Черновик" чтобы скрыть от других пользователей</li>
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Активация кнопки удаления только после подтверждения
document.getElementById('confirmDelete').addEventListener('change', function() {
    document.getElementById('deleteButton').disabled = !this.checked;
});

// Дополнительное подтверждение перед удалением
document.getElementById('deleteForm').addEventListener('submit', function(e) {
    if (!confirm('Вы абсолютно уверены? Это последнее предупреждение!')) {
        e.preventDefault();
        return false;
    }
});
</script>
{% endblock %}
